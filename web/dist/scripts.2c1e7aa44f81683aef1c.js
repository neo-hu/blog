!function(t,e,i){var s={version:"2.10.0",canvasList:[],modules:{},inits:{},plugins:{},core:function(t){for(var i in this.isCore=!0,this.id=s.canvasList.push(this)-1,this.lastObjectID=0,this.children=[],this.domEventHandlers=[],s.modules)this[i]="function"==typeof s.modules[i]?s.modules[i]():Object.create(s.modules[i]);if(this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},s.extend(this.settings,t),this.originalSettings=s.extend({},this.settings),this.settings.canvas.nodeName&&"canvas"===this.settings.canvas.nodeName.toLowerCase())this.canvasElement=this.settings.canvas;else{if("string"!=typeof this.settings.canvas)return!1;this.canvasElement=e.querySelector(this.settings.canvas)}this.canvas=this.canvasElement.getContext("2d");var r=this.canvasElement.width,n=this.canvasElement.height;for(var i in Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,set:function(t){r=isNaN(parseFloat(t))?r:parseFloat(t),this.canvasElement.width=r,this.background.set(this.settings.background),this.redraw()},get:function(){return r}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,set:function(t){n=isNaN(parseFloat(t))?n:parseFloat(t),this.canvasElement.height=n,this.background.set(this.settings.background),this.redraw()},get:function(){return n}}),s.modules){if(!0===this[i].wrapper)for(var a in this[i])"object"==typeof this[i][a]&&"function"==typeof this[i][a].setCore?this[i][a]=this[i][a].setCore(this):"function"==typeof this[i][a].setCore&&this[i][a].setCore(this),this[i].core=this;this[i].core=this}for(var o in s.inits)if("string"==typeof s.inits[o]&&"function"==typeof this[o][s.inits[o]])this[o][s.inits[o]]();else if("object"===s.inits[o])for(var h in s.inits[o])"function"==typeof this[o][s.inits[o][h]]&&this[o][s.inits[o][h]]();var c=this.settings.plugins;if(c.length>0)for(var l=0,d=c.length;l<d;l++)"function"==typeof s.plugins[c[l]]&&s.plugins[c[l]].call(this)},registerModule:function(t,e,r){if(~t.indexOf(".")){var n=t.split(".");s.modules[n[0]][n[1]]=e,r!==i&&(s.inits[n[0]]||(s.inits[n[0]]={}),s.inits[n[0]][n[1]]=r)}else s.modules[t]=e,r!==i&&(s.inits[t]=r)},registerPlugin:function(t,e){s.plugins[t]=e},create:function(t){return new s.core(t)},domReady:function(t){if(this.domReadyHandlers.push(t=t||function(){}),this.isDomReadyListening)return!1;if(this.isDomReady)return s.triggerDomReadyHandlers(),!0;var i=function(t){("complete"===e.readyState||t&&"DOMContentLoaded"===t.type)&&(s.isDomReadyListening=!1,s.isDomReady=!0,s.triggerDomReadyHandlers(),e.removeEventListener("readystatechange",i,!1),e.removeEventListener("DOMContentLoaded",i,!1))};return!!i()||(this.isDomReadyListening?void 0:(s.isDomReadyListening=!0,e.addEventListener("readystatechange",i,!1),e.addEventListener("DOMContentLoaded",i,!1),!1))},isDomReady:!1,isDomReadyListening:!1,domReadyHandlers:[],triggerDomReadyHandlers:function(){var t,e,i,s;for(e=0,i=(t=this.domReadyHandlers).length;e<i;e++)(s=t[e])&&(delete t[e],s())}};s.core.prototype={addChild:function(t,e){return t.add(e),this},addChildAt:function(t,e,i){return t.addAt(e,i),this},removeChild:function(t,e){return t.remove(e),this},removeChildAt:function(t,e){return this.children[t]!==i&&this.children[t].remove(e),this},clear:function(t){return this.draw.clear(t),this},redraw:function(){return this.draw.redraw(),this},bind:function(t,e){return this.events.bind(this.canvasElement,t.split(" "),e),this},unbind:function(t,e){return this.events.unbind(this.canvasElement,t.split(" "),e),this},trigger:function(t,e){var i=this.events;return i.triggerHandlers(this.canvasElement,t.split(" "),i.fixEventObject(e)),this},reset:function(){for(var t=this.children,e=0,i=t.length;e<i;e++)t[e].remove(),e--,i--;t.length=0,this.lastObjectID=0;var r=this.canvasElement.events;for(var n in r)r[n]instanceof Array&&this.unbind(n,r[n]);this.settings=s.extend({},this.originalSettings)},destroy:function(){this.timeline&&this.timeline.stop(),this.reset();for(var t=0,i=this.domEventHandlers.length;t<i;t++)s.removeDOMEventHandler(this,t);this.domEventHandlers.length=0,s.canvasList[this.id]=null,this.canvasElement=e.createElement("canvas"),this.canvas=this.canvasElement.getContext("2d")}},t.oCanvas=s,s.domReady(),s.extend=function(){var t,e,i=Array.prototype.slice.call(arguments),r=i[i.length-1],n=i.splice(0,1)[0],a=i.splice(0,1)[0],o=[];if(r.exclude&&JSON.stringify(r)===JSON.stringify({exclude:r.exclude})&&(o=r.exclude),a!==r||0===o.length)for(t in a)~o.indexOf(t)||((e=Object.getOwnPropertyDescriptor(a,t)).get||e.set?Object.defineProperty(n,t,e):n[t]=a[t]);return i.length>0?s.extend.apply(this,[n].concat(i)):n},s.addDOMEventHandler=function(t,e,i,s,r){t.domEventHandlers.push({obj:e,event:i,handler:s,useCapture:!!r}),e.addEventListener(i,s,r)},s.removeDOMEventHandler=function(t,e){var i=t.domEventHandlers[e];i.obj.removeEventListener(i.event,i.handler,i.useCapture)},s.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),"function"!=typeof Object.getPropertyDescriptor&&(Object.getPropertyDescriptor=function(t,e){for(var s=Object.getOwnPropertyDescriptor(t,e),r=Object.getPrototypeOf(t);s===i&&null!==r;)s=Object.getOwnPropertyDescriptor(r,e),r=Object.getPrototypeOf(r);return s}),function(){for(var e=0,i=["ms","moz","webkit","o"],s=0;s<i.length&&!t.requestAnimationFrame;++s)t.requestAnimationFrame=t[i[s]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[s]+"CancelAnimationFrame"]||t[i[s]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i,s){var r=(new Date).getTime(),n=Math.max(0,16-(r-e)),a=t.setTimeout(function(){i(r+n)},n);return e=r+n,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),t.log=function(){if(log.history=log.history||[],log.history.push(arguments),this.console){var t,e=Array.prototype.slice.call(arguments),i=e.length;for(t=0;t<i;t++)console.log(e[t])}},s.registerModule("timeline",function(){var t={init:function(){var t=this;this.core.setLoop=function(e){return t.userLoop=e,t}},currentFrame:1,timeline:0,running:!1,set fps(t){this.core.settings.fps=t,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){this.running&&setTimeout(function(){t.timeline=requestAnimationFrame(t.loopBound);var e=t.core;"function"==typeof t.userLoop&&(!0===e.settings.clearEachFrame&&e.draw.clear(),t.userLoop.call(e,e.canvas),!0===e.settings.drawEachFrame&&e.draw.redraw(),t.currentFrame++)},1e3/t.fps)},loopBound:function(){t.loop()},start:function(){return cancelAnimationFrame(t.timeline),t.running=!0,t.loop(),this},stop:function(){return this.running=!1,cancelAnimationFrame(t.timeline),this}};return t},"init"),s.registerModule("keyboard",function(){return{keysDown:{},keyPressTimers:{},modifiedKeys:[],init:function(){var t=this;s.addDOMEventHandler(this.core,e,"keydown",function(e){t.docHandler(e)},!1),s.addDOMEventHandler(this.core,e,"keyup",function(e){t.docHandler(e)},!1),s.addDOMEventHandler(this.core,e,"keypress",function(e){t.preventDefault(e)},!1)},docHandler:function(t){var e,i,s,r;if(s=this.core.canvasElement,(i=this.core.events).enabled&&!(this.core.pointer&&!0!==this.core.pointer.canvasFocused||(e=this.getKeyCode(t),this.preventDefault(t),"keydown"===t.type&&!0===this.keysDown[e]||("keydown"===t.type?this.keysDown[e]=!0:"keyup"===t.type&&delete this.keysDown[e],r=i.fixEventObject(t,"keyboard"),i.lastKeyboardEventObject=r,i.triggerHandlers(s,[t.type]),"keydown"===t.type&&(this.keyPressTimers[e]=setInterval(function(){i.triggerHandlers(s,["keypress"],r)},1e3/this.core.settings.fps)),"keyup"!==t.type))))if(this.anyKeysDown())clearInterval(this.keyPressTimers[e]);else for(e in this.keyPressTimers)clearInterval(this.keyPressTimers[e])},preventDefault:function(t){if(this.core.mouse&&!0===this.core.mouse.canvasFocused||!this.core.mouse){var e=this.getKeyCode(t);~this.modifiedKeys.indexOf(e)&&t.preventDefault()}},addPreventDefaultFor:function(t){t="number"==typeof t?[t]:t instanceof Array?t:[];for(var e=0;e<t.length;e++)this.modifiedKeys.push(t[e])},removePreventDefaultFor:function(t){var e,i;for(t="number"==typeof t?[t]:t instanceof Array?t:[],e=0;e<t.length;e++)~(i=this.modifiedKeys.indexOf(t[e]))&&this.modifiedKeys.splice(i,1)},getKeyCode:function(t){return 0===t.keyCode?t.which:t.keyCode},numKeysDown:function(){var t,e,i;for(i in t=0,e=this.keysDown)!0===e[i]&&t++;return t},anyKeysDown:function(){return this.numKeysDown()>0},getKeysDown:function(){var t,e,i;for(i in e=[],t=this.keysDown)!0===t[i]&&e.push(parseInt(i,10));return e},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}},"init"),s.registerModule("mouse",function(){return{x:0,y:0,buttonState:"up",canvasFocused:!1,canvasHovered:!1,cursorValue:"default",init:function(){this.core.events.addEventTypes("mouse",{move:"mousemove",enter:"mouseenter",leave:"mouseleave",down:"mousedown",up:"mouseup",singleClick:"click",doubleClick:"dblclick"}),this.types={mousemove:"move",mousedown:"down",mouseup:"up",dblclick:"doubleClick"},this.core.pointer=this,this.core.touch&&this.core.touch.isTouch||this.bindHandlers()},bindHandlers:function(){var i,r,n,a;for(a in i=this,n=(r=this.core).canvasElement,this.types){s.addDOMEventHandler(r,n,a,function(t){i.canvasHandler(t)},!1),"mousemove"===a&&(a="mouseover"),s.addDOMEventHandler(r,e,a,function(t){i.docHandler(t)},!1);var o=null;try{o=t.parent.document}catch(h){}o&&s.addDOMEventHandler(r,o,a,function(t){i.docHandler(t)},!1)}},canvasHandler:function(t,e){var s,r,n,a;if(s=this.core.events,r=this.onCanvas(t),"mouseup"===t.type&&!r&&!this.canvasUpEventTriggered)return s.triggerPointerEvent(this.types.mouseup,s.frontObject,"mouse",t),s.triggerPointerEvent(this.types.mouseup,this.core.canvasElement,"mouse",t),void(this.canvasUpEventTriggered=!0);(e||r)&&(n=e&&"mouseover"===t.type?"mousemove":t.type,e||(this.canvasHovered=!0),"mousedown"===n&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.buttonState="down"),"mouseup"===n&&(this.buttonState="up"),a=e||!r?i:s.getFrontObject("mouse"),e&&s.frontObject?(s.triggerChain(s.getParentChain(s.frontObject,!0,!0),["mouseleave"]),s.frontObject=null):e?s.triggerHandlers(this.core.canvasElement,["mouseleave"]):s.triggerPointerEvent(this.types[n],a,"mouse",t))},docHandler:function(t){this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"mouseover"===t.type&&this.canvasHandler(t,!0):("mouseup"===t.type&&"down"===this.buttonState&&this.canvasHandler(t,!0),"mousedown"===t.type&&(this.canvasFocused=!1)))},getPos:function(e){var i=this.core.canvasElement,s=i.getBoundingClientRect(),r=i.height/i.clientHeight,n=e.pageY-t.pageYOffset;return{x:i.width/i.clientWidth*(e.pageX-t.pageXOffset-Math.round(s.left)),y:r*(n-Math.round(s.top))}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return e.x>=0&&e.x<=this.core.width&&e.y>=0&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):(this.canvasHovered=!1,!1)},cancel:function(){this.core.events.lastDownObject=null},hide:function(){this.core.canvasElement.style.cursor="none"},show:function(){this.core.canvasElement.style.cursor=this.cursorValue},cursor:function(t){if(~t.indexOf("url(")){var e=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(t),i=e[5]?e[5]:"";t="url("+e[1]+") "+(e[3]?e[3]:0)+" "+(e[4]?e[4]:0)+(""!==i?i:", default")}this.core.canvasElement.style.cursor=t,this.cursorValue=t}}},"init"),s.registerModule("touch",function(){return{x:0,y:0,touchState:"up",canvasFocused:!1,canvasHovered:!1,isTouch:"ontouchstart"in t||"createTouch"in e,dblTapInterval:500,init:function(){var t,e;e=(t=this.core).canvasElement,t.events.addEventTypes("touch",{move:"touchmove",enter:"touchenter",leave:"touchleave",down:"touchstart",up:"touchend",singleClick:"tap",doubleClick:"dbltap"}),this.types={touchmove:"move",touchstart:"down",touchend:"up"},this.isTouch&&(t.pointer=this,e.style.WebkitUserSelect="none",e.style.WebkitTouchCallout="none",e.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.bindHandlers()},bindHandlers:function(){var i,r,n,a;for(a in i=this,n=(r=this.core).canvasElement,this.types){s.addDOMEventHandler(r,n,a,function(t){i.canvasHandler(t)},!1),s.addDOMEventHandler(r,e,a,function(t){i.docHandler(t)},!1);var o=null;try{o=t.parent.document}catch(h){}o&&s.addDOMEventHandler(r,o,a,function(t){i.docHandler(t)},!1)}this.core.settings.disableScrolling&&s.addDOMEventHandler(r,n,"touchmove",function(t){t.preventDefault()},!1)},canvasHandler:function(t,e){var s,r,n,a;if(s=this.core.events,r=this.onCanvas(t),"touchend"===t.type&&!r&&!this.canvasUpEventTriggered)return s.triggerPointerEvent(this.types.touchend,s.frontObject,"touch",t),s.triggerPointerEvent(this.types.touchend,this.core.canvasElement,"touch",t),void(this.canvasUpEventTriggered=!0);(e||r)&&(e||(this.canvasHovered=!0),"touchstart"===t.type&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.touchState="down"),"touchend"===t.type&&(this.touchState="up"),n=e||!r?i:s.getFrontObject("touch"),e&&s.frontObject?(s.triggerChain(s.getParentChain(s.frontObject,!0,!0),["touchleave"]),s.frontObject=null):e?s.triggerHandlers(this.core.canvasElement,["touchleave"]):s.triggerPointerEvent(this.types[t.type],n,"touch",t),"touchstart"===t.type&&(a=(new Date).getTime(),!this.dblTapStart||a-this.dblTapStart.timestamp>this.dblTapInterval?this.dblTapStart={timestamp:a,obj:n,count:1}:this.dblTapStart.count++),"touchend"===t.type&&2===this.dblTapStart.count&&(a=(new Date).getTime(),n===this.dblTapStart.obj&&a-this.dblTapStart.timestamp<this.dblTapInterval&&s.triggerPointerEvent("doubleClick",n,"touch",t),delete this.dblTapStart))},docHandler:function(t){this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"touchmove"===t.type&&this.canvasHandler(t,!0):("touchend"===t.type&&"down"===this.touchState&&this.canvasHandler(t,!0),"touchstart"===t.type&&(this.canvasFocused=!1)))},getPos:function(e){var s,r,n=e.changedTouches;if(n!==i&&n.length>0){e=n[0];var a=this.core.canvasElement,o=a.getBoundingClientRect(),h=a.height/a.clientHeight,c=e.pageY-t.pageYOffset;s=a.width/a.clientWidth*(e.pageX-t.pageXOffset-Math.round(o.left)),r=h*(c-Math.round(o.top))}else s=this.x,r=this.y;return{x:s,y:r}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return e.x>=0&&e.x<=this.core.width&&e.y>=0&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):(this.canvasHovered=!1,!1)},cancel:function(){this.core.events.lastDownObject=null}}},"init"),s.registerModule("tools",function(){return{transformPointerPosition:function(t,e,i,s,r){if(s=s||0,r=r||this.core.pointer,"object"==typeof t){var n,a,o,h,c,l=t.parent,d=[],u={x:0,y:0};for(d.push(t);l&&l!==this.core;)d.push(l),l=l.parent;for(d.reverse(),n=r,o=0,h=d.length;o<h;o++)n=u=this.transformPointerPosition((a=d[o]).rotation,a.abs_x,a.abs_y,0,n);return 0!==s&&(c=t.getOrigin(),u=this.transformPointerPosition(-1*s,e-c.x,i-c.y,0,n)),{x:u.x,y:u.y}}var f,g,p,y=t,b=r.x>=e&&r.y<=i,_=r.x>=e&&r.y>=i,m=r.x<=e&&r.y>=i,v=r.x<=e&&r.y<=i,x=Math.sqrt(Math.pow(r.x-e,2)+Math.pow(r.y-i,2)),w=(y=360*(y/360-Math.floor(y/360))-s,0===x?0:Math.abs(r.y-i)/x);return b||m?(f=(180-y-180*Math.asin(w)/Math.PI)*Math.PI/180,g=e+Math.cos(f)*x*(b?-1:1),p=i+Math.sin(f)*x*(b?-1:1)):(v||_)&&(f=(180*Math.asin(w)/Math.PI-y)*Math.PI/180,g=e+Math.cos(f)*x*(v?-1:1),p=i+Math.sin(f)*x*(v?-1:1)),{x:g,y:p}},isPointerInside:function(t,e){var i=t.getOrigin();if("line"===t.type){var s=Math.abs(t._.end_x-t.abs_x),r=Math.abs(t._.end_y-t.abs_y),n=Math.sqrt(s*s+r*r),a=t.start,o=t.end,h=a.x<o.x&&a.y<o.y||a.x>o.x&&a.y>o.y?-1:1,c=Math.asin(r/n)*(180/Math.PI)*h;return(f=this.transformPointerPosition(t,t.abs_x,t.abs_y,c,e)).x>t.abs_x-n-i.x&&f.x<t.abs_x+n-i.x&&f.y>t.abs_y-t.strokeWidth/2-i.y&&f.y<t.abs_y+t.strokeWidth/2-i.y}if("text"===t.type){var l,d,u,f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),g=t.strokeWidth/2,p=t._.lines,y=p.length,b=t.size*t.lineHeight,_=t.align,m="rtl"===this.core.canvasElement.dir;for(l={top:.05*t.size,hanging:-.12*t.size,middle:-.47*t.size,alphabetic:-.78*t.size,ideographic:-.83*t.size,bottom:-1*t.size},w=0;w<y;w++)if(u=t.abs_y+b*w+l[t.baseline],f.x>(d=t.abs_x+{start:m?t.width-p[w].width:0,left:0,center:(t.width-p[w].width)/2,end:m?0:t.width-p[w].width,right:t.width-p[w].width}[_])-i.x-g&&f.x<d+p[w].width-i.x+g&&f.y>u-i.y-g&&f.y<u+b+(y>0&&w<y-1?1:0)-i.y+g)return!0;return!1}if("rectangular"===t.shapeType)return(f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e)).x>t.abs_x-i.x-(g="outside"===t.strokePosition?t.strokeWidth:"center"===t.strokePosition?t.strokeWidth/2:0)&&f.x<t.abs_x+t.width-i.x+g&&f.y>t.abs_y-i.y-g&&f.y<t.abs_y+t.height-i.y+g;if("ellipse"===t.type&&t.radius_x===t.radius_y)return f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),(n=Math.sqrt(Math.pow(f.x-t.abs_x+i.x,2)+Math.pow(f.y-t.abs_y+i.y,2)))<t.radius_x+t.strokeWidth/2;if("ellipse"===t.type){f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e);var v=t.radius_x+t.strokeWidth/2,x=t.radius_y+t.strokeWidth/2;return f.x-=t.abs_x-i.x,f.y-=t.abs_y-i.y,f.x*f.x/(v*v)+f.y*f.y/(x*x)<1}if("polygon"===t.type){f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e);var w,O,M,k=t.radius+t.strokeWidth/2,P=t.sides,C=P-1,j=!1;for(w=0;w<P;w++)O={x:t.abs_x-i.x+k*Math.cos(2*w*Math.PI/P),y:t.abs_y-i.y+k*Math.sin(2*w*Math.PI/P)},M={x:t.abs_x-i.x+k*Math.cos(2*C*Math.PI/P),y:t.abs_y-i.y+k*Math.sin(2*C*Math.PI/P)},(O.y<f.y&&M.y>=f.y||M.y<f.y&&O.y>=f.y)&&O.x+(f.y-O.y)/(M.y-O.y)*(M.x-O.x)<f.x&&(j=!j),C=w;return j}if("arc"===t.type){var T,E,R=t.end-t.start,F="clockwise"===t.direction?(R<0?360:0)+(R%360?R%360:R>0?360:0):Math.abs(R),D="clockwise"===t.direction?-1*t.start:-1*t.end,H=(f=this.transformPointerPosition(t,t.abs_x,t.abs_y,D,e),n=Math.sqrt(Math.pow(f.x-t.abs_x+i.x,2)+Math.pow(f.y-t.abs_y+i.y,2)),k=t.radius,{}),W={};if(0===t.strokeWidth&&n>k||t.strokeWidth>0&&n>k+t.strokeWidth/2)return!1;if(k===t.strokeWidth/2||t.pieSection){var N,I,L,S,A=t.pieSection?t.radius:A;if(F>180)return N=Math.abs(t.abs_x-i.x-f.x),I=Math.abs(t.abs_y-i.y-f.y),L=Math.sqrt(N*N+I*I),S=180*Math.acos(N/L)/Math.PI,f.y>=t.abs_y-i.y&&n<=A||f.y<t.abs_y-i.y&&f.x<t.abs_x-i.x&&S<=F-180;if(180===F)return f.y>=t.abs_y-i.y&&n<=A;if(F<180)return f=this.transformPointerPosition(t,t.abs_x,t.abs_y,D=90-F/2-("clockwise"===t.direction?t.start:t.end),e),k*=2,B=Math.cos(F/2*Math.PI/180)*k,N=Math.abs(t.abs_x-i.x-f.x),I=Math.abs(t.abs_y-i.y-f.y),L=Math.sqrt(N*N+I*I),S=180*Math.asin(N/L)/Math.PI,f.y>=t.abs_y-i.y+B||f.y>=t.abs_y-i.y&&S<=F/2}else{if(F>180){v=(360-F)/2,T=Math.cos(v*Math.PI/180)*k,H.x=t.abs_x-i.x+Math.cos(v*Math.PI/180)*T,H.y=t.abs_y-i.y-Math.sin(v*Math.PI/180)*T,E=180-2*v,W.x=t.abs_x-i.x-Math.cos(E*Math.PI/180)*k,W.y=t.abs_y-i.y-Math.sin(E*Math.PI/180)*k;var z=90-(90-E)-(90-v);if(f.y<H.y&&f.x<H.x)c=v-180*Math.acos(Math.abs(f.y-H.y)/Math.sqrt(Math.pow(f.x-H.x,2)+Math.pow(f.y-H.y,2)))/Math.PI;else if(f.y>H.y&&f.x>=H.x)c=z-180*Math.acos(Math.abs(f.x-H.x)/Math.sqrt(Math.pow(f.x-H.x,2)+Math.pow(f.y-H.y,2)))/Math.PI;else{if(f.y<t.abs_y-i.y&&f.x>=H.x)return!1;c=-1e6}return!((""===t.fill||"transparent"===t.fill)&&t.strokeWidth>0&&n<k-t.strokeWidth/2)&&(c<=0&&f.x>=W.x&&f.y>H.y&&f.y<t.abs_y-i.y||c<=0&&f.y<=t.abs_y-i.y&&n<=k||(0===t.strokeWidth&&n<=k||t.strokeWidth>0&&n<=k+t.strokeWidth/2)&&(f.x<=W.x&&f.y<=t.abs_y-i.y||f.y>=t.abs_y-i.y))}if(180===F)return f.y>=t.abs_y-i.y&&(0===t.strokeWidth&&n<=k||t.strokeWidth>0&&n<=k+t.strokeWidth/2);var q,B;if(F<180)return f=this.transformPointerPosition(t,t.abs_x,t.abs_y,D=90-F/2-("clockwise"===t.direction?t.start:t.end),e),q=""===t.fill?k-t.strokeWidth/2:k,B=Math.cos(F/2*Math.PI/180)*q,""===t.fill&&t.strokeWidth>0?f.y>=t.abs_y-i.y+B&&n>=k-t.strokeWidth/2&&n<=k+t.strokeWidth/2:f.y>=t.abs_y-i.y+B&&(!(t.strokeWidth>0)||n<=k+t.strokeWidth/2)}}else if("radial"===t.shapeType&&(k=t.radius?t.radius:0)>0)return f=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),i=t.getOrigin(),(n=Math.sqrt(Math.pow(f.x-t.abs_x+i.x,2)+Math.pow(f.y-t.abs_y+i.y,2)))<k}}}),s.registerModule("events",function(){return{enabled:!0,eventTypes:{},init:function(){this.core.canvasElement.events={}},addEventTypes:function(t,e){this.eventTypes[t]=this.eventTypes[t]||[];var i=this.eventTypes[t];for(var s in e)i[s]=i[s]||[],i[s].push(e[s])},bind:function(t,e,i){for(var s=0;s<e.length;s++)t.events[e[s]]=t.events[e[s]]||[],t.events[e[s]].push(i)},unbind:function(t,e,s){var r,n,a;for(r=0;r<e.length;r++)(n=t.events[e[r]])!==i&&(s===i?delete t.events[e[r]]:~(a=n.indexOf(s))&&n.splice(a,1))},findFrontObject:function(t,e){var i,s,r;if(0===t.length)return!1;for(i=t.length;i--&&!1===(r=this.findFrontObject((s=t[i]).children,e));)if(s.pointerEvents&&s.isPointerInside(e)){r=s;break}return r},getFrontObject:function(t){return this.findFrontObject(this.core.children,this.core[t])||i},triggerPointerEvent:function(t,e,i,s){if(this.enabled){var r,n,a,o,h,c,l,d,u,f,g;if(r=this.core.canvasElement,a=(n=this.eventTypes[i]).enter,o=n.leave,h=n[t],c=n.singleClick,this.lastPointerEventObject=this.fixEventObject(s,i),e){if(e!==this.frontObject){if(this.frontObject&&!~(l=this.getParentChain(e)).indexOf(this.frontObject))if(this.triggerHandlers(this.frontObject,o),~(l=this.getParentChain(this.frontObject)).indexOf(e)){for(d=[],f=0,g=l.length;f<g&&l[f]!==e;f++)d.push(l[f]);this.triggerChain(d,o)}else this.triggerChain(l,o);this.frontObject=e,(e.parent||r).events.hasEntered||(l=this.findNonEnteredParentChain(e),this.triggerChain(l,a)),e.events.hasEntered||this.triggerHandlers(e,a)}}else this.frontObject?(d=this.getParentChain(this.frontObject,!1,!0),this.triggerChain(d,o),this.frontObject=null):r.events.hasEntered||this.triggerHandlers(r,a),e=this.core.canvasElement;"down"===t&&(this.lastDownObject=e),d=this.getParentChain(e,!0,!0),this.triggerChain(d,h),"up"===t&&(e===this.lastDownObject?this.triggerChain(d,c):(u=this.getSharedParent(e,this.lastDownObject))&&(d=this.getParentChain(u,!0,!0),this.triggerChain(d,c)),this.lastDownObject=null)}},getSharedParent:function(t,e){var s,r,n;for(s=this.getParentChain(t,!0,!0),r=this.core.canvasElement,n=e;n&&!~s.indexOf(n);)n=n.parent||(n!==r?r:i);return n},findNonEnteredParentChain:function(t){var e,i,s;for(e=[],i=this.core.canvasElement,s=t.parent;s&&!s.events.hasEntered;)e.push(s),s=s.parent;return s||i.events.hasEntered||e.push(i),e.reverse()},getParentChain:function(t,e,i){var s,r;for(s=[],i&&s.push(t),r=t.parent;r;)s.push(r),r=r.parent;return e&&t!==this.core.canvasElement&&s.push(this.core.canvasElement),s},triggerChain:function(t,e,i){var s,r;for(s=0,r=t.length;s<r&&this.triggerHandlers(t[s],e,i);s++);},triggerHandlers:function(t,e,i){var s,r,n,a,o,h,c,l=t===this.core.canvasElement?this.core:t;for(s=0;s<e.length;s++)if(r=t.events[e[s]],n=!!~e[s].indexOf("enter"),a=!!~e[s].indexOf("leave"),(c=i||(~e[s].indexOf("key")?this.lastKeyboardEventObject:this.lastPointerEventObject)).type=e[s],c.bubbles=!n&&!a,n&&!t.events.hasEntered?t.events.hasEntered=!0:a&&t.events.hasEntered&&(t.events.hasEntered=!1),r){for(o=r.length,h=0;h<o;h++)"function"==typeof r[h]&&r[h].call(l,c);if(c.stoppingPropagation)return c.stoppingPropagation=!1,!1}return!0},fixEventObject:function(t,e){var s,r,n,a,o="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),h=o.length;if(s={originalEvent:t,timeStamp:(new Date).getTime(),which:t===i?0:0===t.which?t.keyCode:t.which,preventDefault:function(){t!==i&&t.preventDefault()},stopPropagation:function(){this.bubbles&&(this.stoppingPropagation=!0),t!==i&&t.stopPropagation()}},t===i)return s;for(r=0;r<h;r++)t[n=o[r]]!==i&&(s[n]=t[n]);return~"mouse touch".indexOf(e)&&(s.x=this.core[e].x,s.y=this.core[e].y),"mouse"===e&&(s.which=(a={0:1,2:2,1:3,default:0})[s.button]||a.default),"touch"===e&&(s.which=0),s}}},"init"),s.registerModule("draw",function(){return{objects:[],translation:{x:0,y:0},changeZorder:function(t,e,s){var r,n,a,o=t.children,h=o[e];h!==i&&e!==s&&(s>o.length-1&&(s=o.length-1),s<0&&(s=0),s>e?(r=o.slice(0,e),a=o.slice(s+1,o.length),(n=o.slice(e,s+1)).shift(),n.push(h)):(r=o.slice(0,s),a=o.slice(e+1,o.length),(n=o.slice(s,e+1)).pop(),n.unshift(h)),t.children=r.concat(n).concat(a))},clear:function(t){return this.core.canvas.clearRect(0,0,this.core.width,this.core.height),!1!==t&&this.core.background.redraw(),this.isCleared=!0,this},redraw:function(t){return t=t||!1,(this.core.settings.clearEachFrame||t)&&this.clear(),this.isCleared=!1,this.drawObjects(this.core.children),this},drawObjects:function(t){var e,s,r,n,a,o,h,c=this.core.canvas;for(e=0,s=t.length;e<s;e++)if((r=t[e])!==i&&"function"==typeof r.draw){c.strokeStyle="#000",c.fillStyle="#000",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.lineDashOffset=0,c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,c.shadowColor="rgba(0, 0, 0, 0)",c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.textAlign="start",c.textBaseline="alphabetic",c.direction="inherit",c.imageSmoothingEnabled=!0,"function"==typeof r.update&&r.update(),c.save(),c.translate(r.x,r.y),0!==r.rotation&&c.rotate(r.rotation*Math.PI/180),1===r.scalingX&&1===r.scalingY||c.scale(r.scalingX,r.scalingY),h=r.opacity;for(var l=r.parent;l&&l!==this.core;)h*=l.opacity,l=l.parent;this.translation={x:r.abs_x,y:r.abs_y},n=r.abs_x,a=r.abs_y,r._.abs_x=0,r._.abs_y=0,c.globalAlpha=isNaN(parseFloat(h))?1:parseFloat(h),c.globalCompositeOperation=r.composition,(o=r.shadow).blur>0&&(c.shadowOffsetX=o.offsetX,c.shadowOffsetY=o.offsetY,c.shadowBlur=o.blur,c.shadowColor=o.color),c.lineCap=r.cap,c.lineJoin=r.join,c.miterLimit=r.miterLimit,r.draw(),r.drawn=!0,r._.abs_x=n,r._.abs_y=a,r.children.length>0&&this.drawObjects(r.children),c.restore(),this.translation={x:0,y:0}}}}}),s.registerModule("background",function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(t){var e=this;if("string"!=typeof t&&(t=""),this.value=t,this.type=~t.indexOf("gradient")?"gradient":~t.indexOf("image")?"image":this.core.style&&this.core.style.isColor(t)?"color":"transparent","color"===this.type)this.bg=t,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("gradient"===this.type)this.bg=this.core.style?this.core.style.getGradient(t,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("image"===this.type){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),s=i[1],r=i[4]||"repeat",n=new Image;n.src=s,n.onload=function(){e.bg=e.core.canvas.createPattern(this,r),e.loaded=!0,e.core.timeline&&!e.core.timeline.running&&e.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(){var t=this.core;"transparent"!==this.type&&(t.canvas.fillStyle=this.bg,t.canvas.fillRect(0,0,t.width,t.height))}}},"init"),s.registerModule("scenes",function(){return{current:"none",scenes:{},create:function(t,e){return this.scenes[t]=Object.create(this.scenesBase()),this.scenes[t].name=t,e.call(this.scenes[t]),this.scenes[t]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(t){return this.objects.push(t),this.loaded&&t.add(),this},remove:function(t){var e=this.objects.indexOf(t);return~e&&(this.objects.splice(e,1),this.loaded&&t.remove()),this},load:function(){if(!this.loaded){var t,e=this.objects,s=e.length;for(t=0;t<s;t++)e[t]!==i&&e[t].add(!1);return this.loaded=!0,this}},unload:function(){var t,e=this.objects,s=e.length;for(t=0;t<s;t++)e[t]!==i&&e[t].remove(!1);return this.loaded=!1,this}}},load:function(t,e){return!0===e&&"none"!==this.current&&this.unload(this.current),this.current=t,this.scenes[t].load(),this.core.draw.redraw(),this},unload:function(t){return this.current="none",this.scenes[t].unload(),this.core.draw.redraw(),this}}}),s.registerModule("style",function(){return{getStroke:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var s=t;t="string"==typeof s.pos?s.pos:"center",t+=" "+("number"==typeof s.width?s.width+"px":"1px"),t+=" "+("string"==typeof s.color?s.color:"#000000")}for(var r,n,a=t.split(" "),o=0,h=a.length;o<h;o++)!r&&a[o].indexOf("(")>-1&&(r=o),a[o].indexOf(")")>-1&&(n=o);(c=n?a.splice(r,n-r+1):i)&&a.push(c.join(" "));var c,l,d="",u=a.length;if(u>=3)if(~["outside","center","inside"].indexOf(a[0])){if(u>3){for(o=2;o<u;o++)d+=a[o]+(o===u-1?" ":"");a=[a[0],a[1],d]}a={pos:a[0],width:parseFloat(a[1]),color:a[2]}}else{for(o=(l=isNaN(parseInt(a[0])))?0:1;o<u;o++)d+=a[o]+(o===u-1?" ":"");a=l?[1,d]:[a[0],d],u=2}return 2===u&&(a={pos:"center",width:parseFloat(a[0]),color:a[1]}),a.length&&(a={pos:"center",width:0,color:""}),"string"===e?a.pos+" "+a.width+"px "+a.color:"object"===e?a:void 0},getGradient:function(t,e,i,s,r){return~t.indexOf("linear")?this.getLinearGradient(t,e,i,s,r):~t.indexOf("radial")?this.getRadialGradient(t,e,i,s,r):"transparent"},getLinearGradient:function(t,e,i,s,r){var n,a,o,h,c,l,d,u,f,g,p,y,b=[],_=["top","bottom","left","right"],m=[];for(a=/\((.*)\)/.exec(t)[1];f=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(a);)g=m.push(f[1])-1,a=a.substring(0,f.index)+"###"+g+"###"+a.substring(f.index+f[1].length,a.length);if(o=(a=a.split(","))[0].split(" "),(~_.indexOf(o[0])||~o[0].indexOf("deg"))&&b.push(o[0]),o.length>1&&~_.indexOf(o[1])&&b.push(o[1]),0===b.length?b.push("top"):h=1,1===b.length){if("top"===b[0])c=e+s/2,l=i,d=e+s/2,u=i+r;else if("right"===b[0])c=e+s,l=i+r/2,d=e,u=i+r/2;else if("bottom"===b[0])c=e+s/2,l=i+r,d=e+s/2,u=i;else if("left"===b[0])c=e,l=i+r/2,d=e+s,u=i+r/2;else if(~b[0].indexOf("deg")){var v,x,w,O,M,k,P,C=Math.PI,j=e+s/2,T=i+r/2;x=v=parseFloat(b)%360*C/180,v>=0&&v<C/2?(M=e+s,k=i):v>=C/2&&v<C?(P=T,T=j,k=e,M=P,j=i):v>=C&&v<1.5*C?(P=T,M=j,j=e,T=i+r,k=P):v>=1.5*C&&v<2*C&&(P=T,T=e+s,k=j,M=i+r,j=P),v%=C/2,w=Math.atan(Math.abs(T-k)/Math.abs(M-j)),O=Math.sqrt(Math.pow(T-k,2)+Math.pow(j-M,2))*Math.cos(w-v),x>=0&&x<C/2?(c=2*j-(d=j+O*Math.cos(v)),l=2*T-(u=T-O*Math.sin(v))):x>=C/2&&x<C?(c=2*T-(d=T-O*Math.cos(C/2-v)),l=2*M-(u=M-O*Math.sin(C/2-v))):x>=C&&x<1.5*C?(c=2*M-(d=M+O*Math.cos(C-v)),l=2*k-(u=k+O*Math.sin(C-v))):x>=1.5*C&&x<2*C&&(c=2*k-(d=k-O*Math.cos(1.5*C-v)),l=2*j-(u=j-O*Math.sin(1.5*C-v)))}}else~b.indexOf("top")&&~b.indexOf("left")?(c=e,l=i,d=e+s,u=i+r):~b.indexOf("top")&&~b.indexOf("right")?(c=e+s,l=i,d=e,u=i+r):~b.indexOf("bottom")&&~b.indexOf("left")?(c=e,l=i+r,d=e+s,u=i):~b.indexOf("bottom")&&~b.indexOf("right")&&(c=e+s,l=i+r,d=e,u=i);for(n=this.core.canvas.createLinearGradient(c,l,d,u),p=this.getColorStops(n,a.slice(h),m),y=0;y<p.length;y++)n.addColorStop(p[y].pos/100,p[y].color);return n},getRadialGradient:function(t,e,s,r,n){var a,o,h,c,l,d,u,f,g,p,y,b=["left","center","right"],_=["top","center","bottom"],m={left:e,center:e+r/2,right:e+r},v={top:s,center:s+n/2,bottom:s+n},x=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],w=[],O=0,M=[{x:i,y:i,r:0},{x:i,y:i,r:i}],k=!1;for(o=/\((.*)\)/.exec(t)[1];c=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(o);)l=w.push(c[1])-1,o=o.substring(0,c.index)+"###"+l+"###"+o.substring(c.index+c[1].length,o.length);for(o=o.split(/\s*,\s*/),h=0;h<2;h++)~o[h].indexOf(" ")?("center"===(f=o[h].split(" "))[0]?(M[h].x=f[0],M[h].y=f[1],O=h+1):~b.indexOf(f[0])?(M[h].x=f[0],O=h+1,~_.indexOf(f[1])&&(M[h].y=f[1])):~_.indexOf(f[0])?(M[h].y=f[0],O=h+1,~b.indexOf(f[1])&&(M[h].x=f[1])):isNaN(parseFloat(f[0]))||(M[h].x=f[0],O=h+1,!~_.indexOf(f[1])&&isNaN(parseFloat(f[1]))||(M[h].y=f[1])),M[h].x||(M[h].x="center"),M[h].y||(M[h].y="center")):(~b.indexOf(o[h])?(M[h].x=o[h],O=h+1):~_.indexOf(o[h])?(M[h].y=o[h],O=h+1):M[h].x=1===h?M[0].x:"center",M[h].y=1===h?M[0].y:"center");for(~x.indexOf(o[O])&&(y=o[O],k=!0),/\d+(%|px)\s/.test(o[O])&&(y=parseFloat(o[O]),k=!0,isNaN(y)&&(y=0)),y===i&&(y="cover"),h=0;h<2;h++)for(M[h].abs_x=m[M[h].x],M[h].abs_y=v[M[h].y],g=0;g<2;g++)M[h][p="abs_"+(0===g?"x":"y")]===i&&(M[h][p]=parseFloat(M[h]["abs_x"===p?"x":"y"]),isNaN(M[h][p])&&(M[h][p]="abs_x"===p?m.center-e:v.center-s),~M[h]["abs_x"===p?"x":"y"].indexOf("%")&&(M[h][p]=M[h][p]/100*("abs_x"===p?r:n)),M[h][p]+="abs_x"===p?e:s);for(~x.indexOf(y)&&(y="closest-side"===y||"contain"===y?Math.min(Math.abs(M[1].abs_y-s),Math.abs(s+n-M[1].abs_y),Math.abs(M[1].abs_x-e),Math.abs(e+r-M[1].abs_y)):"closest-corner"===y?Math.min(Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+r-M[1].abs_x,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+r-M[1].abs_x,2)+Math.pow(s+n-M[1].abs_y,2)),Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(s+n-M[1].abs_y,2))):"farthest-corner"===y||"cover"===y?Math.max(Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+r-M[1].abs_x,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+r-M[1].abs_x,2)+Math.pow(s+n-M[1].abs_y,2)),Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(s+n-M[1].abs_y,2))):"farthest-side"===y?Math.max(Math.abs(M[1].abs_y-s),Math.abs(s+n-M[1].abs_y),Math.abs(M[1].abs_x-e),Math.abs(e+r-M[1].abs_y)):0),~o[O].indexOf("%")&&(y=y/100*(~o[O].indexOf(" ")&&"height"===o[O].split(" ")[1]?n:r)),M[1].r=y,a=this.core.canvas.createRadialGradient(M[0].abs_x,M[0].abs_y,M[0].r,M[1].abs_x,M[1].abs_y,M[1].r),d=this.getColorStops(a,o.slice(O+(k?1:0)),w),u=0;u<d.length;u++)a.addColorStop(d[u].pos/100,d[u].color);return a},getColorStops:function(t,e,s){var r,n,a,o,h,c=e.length,l=[];for(r=0;r<c&&(n=e[r].trim(),!(h>=100));r++)~n.indexOf(" ")?(o=(a=n.split(" "))[0],h=~(h=a[1]).indexOf("px")?parseFloat(h)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:parseFloat(h)):(o=n,h===i?h=0:(h=h||0,h+=(100-h)/(c-r))),~o.indexOf("###")&&(o=s[/###(\d+)###/.exec(o)[1]]),l.push({pos:h,color:o});return l},getFont:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var s=t;t="string"==typeof s.style?s.style:"normal",t+=" "+("string"==typeof s.variant?s.variant:"normal"),t+=" "+("string"==typeof s.weight?s.weight:"normal"),t+=" "+("number"==typeof s.size?~~(10*s.size+.5)/10+"px":"16px"),t+="/"+("number"==typeof s.lineHeight?~~(10*s.lineHeight+.5)/10:"string"==typeof s.lineHeight&&s.lineHeight.indexOf("px")>-1?s.lineHeight:1),t+=" "+("string"==typeof s.family?s.family:"sans-serif")}if(t.length>0){var r,n,a,o=t.split(" "),h=o.length,c="",l=["normal","italic","oblique"],d=["normal","small-caps"],u=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],f={};for(r=0;r<h;r++)if(~l.indexOf(t=o[r])&&!f.style)f.style=t;else if(~d.indexOf(t)&&!f.variant)f.variant=t;else if(~u.indexOf(t)&&!f.weight)f.weight=t;else if(!~t.indexOf("/")||f.size||f.lineHeight){if(!f.size&&/\d+[a-z]{2}(?!\/)/.test(t))isNaN(parseInt(t))||(f.size=parseInt(t));else if(isNaN(parseInt(t))&&!f.family){for(c="",a=r;a<h;a++)c+=o[a]+(a===h-1?"":" ");f.family=c}}else n=t.split("/"),isNaN(parseInt(n[0]))||(f.size=parseInt(n[0])),isNaN(parseFloat(n[1]))||(f.lineHeight=parseFloat(n[1]),f.lineHeightUnit=n[1].indexOf("px")>-1?"px":"relative")}return(o=f||{}).style=o.style?o.style:"normal",o.variant=o.variant?o.variant:"normal",o.weight=o.weight?o.weight:"normal",o.size=o.size!==i?o.size:16,o.lineHeight=o.lineHeight!==i?o.lineHeight:1,o.lineHeightUnit=o.lineHeightUnit!==i?o.lineHeightUnit:"relative",o.family=o.family?o.family:"sans-serif","string"===e?o.style+" "+o.variant+" "+o.weight+" "+o.size+"px/"+o.lineHeight+("px"===o.lineHeightUnit?"px":"")+" "+o.family:"object"===e?o:void 0},getShadow:function(t,e){var i={};if("object"==typeof t)i.offsetX=isNaN(parseFloat(t.offsetX))?0:parseFloat(t.offsetX),i.offsetY=isNaN(parseFloat(t.offsetY))?0:parseFloat(t.offsetY),i.blur=isNaN(parseFloat(t.blur))?0:parseFloat(t.blur),i.color=this.isColor(t.color)?t.color:"#000";else if("string"==typeof t){var s=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(t);i.offsetX=isNaN(parseFloat(s[1]))?0:parseFloat(s[1]),i.offsetY=isNaN(parseFloat(s[2]))?0:parseFloat(s[2]),i.blur=isNaN(parseFloat(s[3]))?0:parseFloat(s[3]),i.color=this.isColor(s[4])?s[4]:"#000"}return"string"===e?i.offsetX+"px "+i.offsetY+"px "+i.blur+"px "+i.color:i},isColor:function(t){return"string"==typeof t&&("#"===t[0]||"rgb("===t.substr(0,4)||"rgba("===t.substr(0,5)||"hsl("===t.substr(0,4)||"hsla("===t.substr(0,5))}}}),t.logs=[],s.registerModule("animation",function(){var t={durations:{short:500,normal:1e3,long:2e3},defaults:{duration:"normal",easing:"ease-in-out"},animate:function(t,e){var i=this.parseArguments(e),s=i.properties,r=i.options,n=this.queues.create(t,r.queue);n.add({obj:t,properties:s,startValues:{},diffValues:{},options:{queue:n,duration:r.duration,easing:r.easing,callback:r.callback}}),n.run()},parseArguments:function(t){var e,i;return(t=Array.prototype.slice.call(t))[1]=t[1]||{},"object"==typeof t[1]?(i=t[0],(e=s.extend({duration:this.defaults.duration,easing:this.defaults.easing,queue:"default",callback:function(){}},t[1])).easing=this.parseEasingOption(e.easing),e.duration=this.parseDurationOption(e.duration)):(i=t.shift(),e=this.getAnimateArguments(t)),{properties:i,options:e}},parseEasingOption:function(t){return"string"==typeof t?~t.indexOf("cubic-bezier")?this.getCustomCubicBezier(t)||this.easing[this.defaults.easing]:this.easing[t]||this.easing[this.defaults.easing]:"function"==typeof t?t:this.easing[this.defaults.easing]},parseDurationOption:function(e){var i=t.durations;return"string"==typeof e?i[e]||i[t.defaults.duration]:e},runAnimation:function(t,e){var i;i=t.obj,t.advanceCallback=e,this.mainTimer.add(t);var s=this.parseProperties(t.properties,i);t.properties=s.properties,t.startValues=s.startValues,t.diffValues=s.diffValues,t.startTime=(new Date).getTime()},parseProperties:function(t,e){var i={},r={};for(var n in t)if(s.isNumber(t[n]))i[n]=e[n]||0,r[n]=t[n]-(e[n]||0);else if("object"==typeof t[n]){var a=this.parseProperties(t[n],e[n]);i[n]=a.startValues,r[n]=a.diffValues}else delete t[n];return{properties:t,startValues:i,diffValues:r}},tick:function(t){var e,i,s,r,n,a;if((i=(e=(new Date).getTime()-t.startTime)/t.options.duration)>1)return this.setEndValues(t),!1;for(a in s=1===t.options.easing.length?t.options.easing.call(this.easing,i):t.options.easing.call(this.easing,e,0,1,t.options.duration),r=t.startValues,n=t.diffValues)this.setObjectProperty(t.obj,a,r[a],n[a],s);return!0},setObjectProperty:function(t,e,i,r,n){if(s.isNumber(i))t[e]=i+r*n;else for(var a in i)this.setObjectProperty(t[e],a,i[a],r[a],n)},setEndValues:function(t){var e=t.obj,i=t.startValues,s=t.diffValues;for(var r in t.properties)this.setObjectProperty(e,r,i[r],s[r],1);this.core.timeline.running||this.core.draw.redraw(!0)},getAnimateArguments:function(t){var e,s,r,n;return"number"==typeof t[0]?e=t[0]:"string"==typeof t[0]?t[0]in this.durations?e=this.durations[t[0]]:t[0]in this.easing&&(s=this.easing[t[0]]):"boolean"==typeof t[0]?r=t[0]:"function"==typeof t[0]&&"function"==typeof t[1]&&(s=t[0],n=t[1]),"string"==typeof t[1]?s=this.easing[t[1]]:"function"==typeof t[1]&&(t[2]!==i?s=t[1]:n=t[1]),t[2]!==i&&("function"==typeof t[2]?n=t[2]:r=!!t[2]),t[3]!==i&&(n=t[3]),s||((s=~(s="string"==typeof t[0]?t[0]:"").indexOf("cubic-bezier")?s:i)||(s=~(s="string"==typeof t[1]?t[1]:"").indexOf("cubic-bezier")?s:i),s&&(s=this.getCustomCubicBezier(s))),{duration:e=e||this.durations[this.defaults.duration],easing:s=s||this.easing[this.defaults.easing],queue:(r=r!==i&&r)?i:"default",callback:n=n||function(){}}},getCustomCubicBezier:function(t){var e,i,s,r,n;if(e=t.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/))return i=isNaN(parseFloat(e[1]))?0:parseFloat(e[1]),s=isNaN(parseFloat(e[2]))?0:parseFloat(e[2]),r=isNaN(parseFloat(e[3]))?1:parseFloat(e[3]),n=isNaN(parseFloat(e[4]))?1:parseFloat(e[4]),function(t){return this.cubicBezier(i,s,r,n,t)}},stop:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!1)},finish:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!0)},delay:function(t,e,i){var s=t.animationQueues[i&&i.queue||"default"];s&&s.add({type:"delay",duration:e||0})},mainTimer:{animations:[],add:function(t){this.animations.push(t),1===this.animations.length&&this.start()},remove:function(t){this.animations.splice(this.animations.indexOf(t),1),0===this.animations.length&&this.stop()},start:function(){this.tick()},stop:function(){cancelAnimationFrame(this.timer)},tick:function(){var e=this;setTimeout(function(){e.timer=requestAnimationFrame(function(){e.tick()});for(var i,s=e.animations,r=0,n=s.length;r<n;r++)(i=s[r]).cancelled||t.tick(i)||(t.mainTimer.remove(i),r--,n--,i.advanceCallback(),i.options.callback.call(i.obj));t.core.timeline.running||t.core.draw.redraw(!0)},1e3/t.core.settings.fps)}},queues:{create:function(e,s){return s===i&&(s=Math.round((new Date).getTime()*Math.random()).toString()),e.animationQueues[s]||(e.animationQueues[s]={name:s,list:[],isRunning:!1,add:function(t){this.list.push(t)},remove:function(t){if(t){var e=this.list.indexOf(t);~e&&this.list.splice(e,1)}else this.list.shift()},run:function(){if(!this.isRunning&&this.list.length>0){this.isRunning=!0;var e=this.list[0],i=this;"delay"===e.type?setTimeout(function(){i.advance()},e.duration):t.runAnimation(e,function(){i.advance()})}},advance:function(){this.list.shift(),this.isRunning=!1,this.run()},clear:function(e){if(this.isRunning){var i=this.list[0];i.cancelled=!0,e&&(t.setEndValues(i),i.options.callback.call(i.obj)),this.isRunning=!1,t.mainTimer.remove(i)}this.list.length=0}}),this.get(e,s)},get:function(t,e){return t.animationQueues[e]}},easing:{"ease-in":function(t){return this.cubicBezier(.42,0,1,1,t)},"ease-out":function(t){return this.cubicBezier(0,0,.58,1,t)},"ease-in-out":function(t){return this.cubicBezier(.42,0,.58,1,t)},linear:function(t){return t},"ease-in-quad":function(t,e,i,s){return i*(t/=s)*t+e},"ease-out-quad":function(t,e,i,s){return-i*(t/=s)*(t-2)+e},"ease-in-out-quad":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,i,s){return i*(t/=s)*t*t+e},"ease-out-cubic":function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},"ease-in-out-cubic":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,i,s){return i*(t/=s)*t*t*t+e},"ease-out-quart":function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},"ease-in-out-quart":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},"ease-out-quint":function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},"ease-out-sine":function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},"ease-in-expo":function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},"ease-out-expo":function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},"ease-in-out-expo":function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},"ease-in-circ":function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},"ease-out-circ":function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},"ease-in-out-circ":function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},"ease-in-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(1==(t/=s))return e+i;if(n||(n=.3*s),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else a=n/(2*Math.PI)*Math.asin(i/r);return-r*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)+e},"ease-out-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(1==(t/=s))return e+i;if(n||(n=.3*s),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else a=n/(2*Math.PI)*Math.asin(i/r);return r*Math.pow(2,-10*t)*Math.sin((t*s-a)*(2*Math.PI)/n)+i+e},"ease-in-out-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(2==(t/=s/2))return e+i;if(n||(n=s*(.3*1.5)),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else a=n/(2*Math.PI)*Math.asin(i/r);return t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)*.5+i+e},"ease-in-back":function(t,e,s,r,n){return n==i&&(n=1.70158),s*(t/=r)*t*((n+1)*t-n)+e},"ease-out-back":function(t,e,s,r,n){return n==i&&(n=1.70158),s*((t=t/r-1)*t*((n+1)*t+n)+1)+e},"ease-in-out-back":function(t,e,s,r,n){return n==i&&(n=1.70158),(t/=r/2)<1?s/2*(t*t*((1+(n*=1.525))*t-n))+e:s/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},"ease-in-bounce":function(t,e,i,s){return i-this["ease-out-bounce"](s-t,0,i,s)+e},"ease-out-bounce":function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"ease-in-out-bounce":function(t,e,i,s){return t<s/2?.5*this["ease-in-bounce"](2*t,0,i,s)+e:.5*this["ease-out-bounce"](2*t-s,0,i,s)+.5*i+e},cubicBezier:function(t,e,i,s,r){var n,a=1-3*i+3*t-0,o=3*i-6*t+0,h=3*t-0,c=1-3*s+3*e-0,l=3*s-6*e+0,d=3*e-0,u=r;for(n=0;n<5;n++)u=(u-=1/(3*a*u*u+2*o*u+h)*(a*u*u*u+o*u*u+h*u+0-r))>1?1:u<0?0:u;return Math.abs(c*u*u*u+l*u*u+d*u*0)}}};return t});var r=function(){var t=function(t,e,i,s,r){var n=r.style.getStroke(t.stroke);n[e]=i,t.stroke=r.style.getStroke(n,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},events:{},children:[],added:!1,opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,pointerEvents:!0,animationQueues:{},_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,drawn:!1,stroke:"",strokeColor:"black",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(e){t(this,"color",e,0,this.core)},set strokeWidth(e){t(this,"width",e,0,this.core)},set strokePosition(e){t(this,"pos",e,0,this.core)},set stroke(t){"string"!=typeof t&&(t=this.core.style.getStroke(t,"string"));var e=this.core.style.getStroke(t);if(~e.color.indexOf("image(")){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(e.color),s=i[1],r=i[4]||"repeat",n=new Image,a=this;n.src=s,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,n.onload=function(){a._.strokeColor=a.core.canvas.createPattern(this,r),a._.strokepattern_loading=!1,a._.strokepattern_redraw&&(a._.strokepattern_redraw=!1,a.redraw())}}else this._.strokeColor=e.color;this._.strokeWidth=e.width,this._.strokePosition=e.pos,this._.stroke=t},set cap(t){this._.cap=~["butt","round","square"].indexOf(t)?t:"butt"},set join(t){this._.join=~["round","bevel","miter"].indexOf(t)?t:"miter"},set miterLimit(t){this._.miterLimit=isNaN(parseFloat(t))?10:parseFloat(t)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading)return this._.strokepattern_redraw=!0,"";if(~this._.strokeColor.toString().indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var t=this.getOrigin();if("rectangular"===this.shapeType){var e="outside"===this.strokePosition?this.strokeWidth:"center"===this.strokePosition?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-e,this.abs_y-t.y-e,this.width+2*e,this.height+2*e)}if("radial"===this.shapeType){var i=this.radius+this.strokeWidth/2;return t.x+=this.radius,t.y+=this.radius,this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*i,2*i)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(t){if(~t.indexOf("image(")){var e=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),i=e[1],s=e[4]||"repeat",r=new Image,n=this;r.src=i,this._.pattern_loading=!0,this._.pattern_redraw=!1,r.onload=function(){n._.fill=n.core.canvas.createPattern(this,s),n._.pattern_loading=!1,n._.pattern_redraw&&(n._.pattern_redraw=!1,n.redraw())}}else this._.fill=t},get fill(){if(this._.pattern_loading)return this._.pattern_redraw=!0,"";if(~this._.fill.toString().indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var t=this.getOrigin();return"rectangular"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x,this.abs_y-t.y,this.width,this.height):"radial"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*this.radius,2*this.radius):void 0},set shadow(t){"string"!=typeof t&&(t=this.core.style.getShadow(t,"string"));var e=this.core.style.getShadow(t);this._.shadow=e},set shadowOffsetX(t){isNaN(parseFloat(t))||(this._.shadow.offsetX=parseFloat(t))},set shadowOffsetY(t){isNaN(parseFloat(t))||(this._.shadow.offsetY=parseFloat(t))},set shadowBlur(t){isNaN(parseFloat(t))||(this._.shadow.blur=parseFloat(t))},set shadowColor(t){this.core.style.isColor(t)&&(this._.shadow.color=t)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(t){this._.x=t,this._.abs_x=t+(this.parent!==i&&this.parent!==this.core?this.parent.abs_x:0);var e,s=this.children,r=s.length;for(e=0;e<r;e++)s[e]._.abs_x=this.abs_x+s[e].x,s[e].x+=0},set y(t){this._.y=t,this._.abs_y=t+(this.parent!==i&&this.parent!==this.core?this.parent.abs_y:0);var e,s=this.children,r=s.length;for(e=0;e<r;e++)s[e]._.abs_y=this.abs_y-s[e].y,s[e].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(t){},set abs_y(t){},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(t){this._.width=t},get width(){return this._.width},set height(t){this._.height=t},get height(){return this._.height},set zIndex(t){this.parent&&("front"===t&&(t=this.parent.children.length-1),"back"===t&&(t=0),this.core.draw.changeZorder(this.parent,this.zIndex,t))},get zIndex(){return this.parent&&this.parent.children.indexOf(this)},get drawn(){return!this.core.draw.isCleared&&this._.drawn},set drawn(t){this._.drawn=!!t},bind:function(t,e){return this.core.events.bind(this,t.split(" "),e),this},unbind:function(t,e){return this.core.events.unbind(this,t.split(" "),e),this},trigger:function(t,e){var i=this.core.events,s=i.getParentChain(this,!0,!0);return i.triggerChain(s,t.split(" "),i.fixEventObject(e)),this},add:function(t){return this.addAt(this.core.children.length,t)},addAt:function(t,e){return this.added||(e=e===i||e,t>=this.core.children.length?this.core.children.push(this):t<0?this.core.children.unshift(this):this.core.children.splice(t,0,this),this.added=!0,this.parent=this.core,this.core.draw.objects.push(this),e&&this.core.draw.redraw()),this},remove:function(t){if(t=t===i||t,!this.parent)return this;var e=this.parent.children.indexOf(this);if(~e){this.parent.children.splice(e,1),this.parent=i,this.added=!1,this.drawn=!1;var s=this.core.draw.objects.indexOf(this);~s&&this.core.draw.objects.splice(n,1);for(var r=this.children,n=0,a=r.length;n<a;n++)r[n].drawn=!1,~(s=this.core.draw.objects.indexOf(r[n]))&&this.core.draw.objects.splice(s,1);t&&this.core.draw.redraw()}return this},draw:function(){},redraw:function(){return this.core.draw.redraw(),this},rotate:function(t){return this.rotation+=t,this},rotateTo:function(t){return this.rotation=t,this},getArgs:function(t,e,s,r){if(s=s||0,r=r||0,"string"==typeof e){var n=t;t="x"===e?n:s,e="y"===e?n:r}else e===i&&(e=t);return{x:t,y:e}},move:function(t,e){var i=this.getArgs(t,e);return this.x+=i.x,this.y+=i.y,this},moveTo:function(t,e){var i=this.getArgs(t,e,this.x,this.y);return this.x=i.x,this.y=i.y,this},scale:function(t,e){var i=this.getArgs(t,e,1,1);return this.scalingX=i.x,this.scalingY=i.y,this},scaleTo:function(t,e){var i="rectangular"===this.shapeType?this.width:this.radius,s="rectangular"===this.shapeType?this.height:this.radius,r=this.getArgs(t,e,i,s);return r.x=r.x<=0?1:r.x,r.y=r.y<=0?1:r.y,this.scalingX=r.x/i,this.scalingY=r.y/s,this},animate:function(){return this.core.animation.animate(this,arguments),this},stop:function(){return this.core.animation.stop(this),this},finish:function(){return this.core.animation.finish(this),this},delay:function(t,e){return this.core.animation.delay(this,t,e),this},fadeIn:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:1}].concat(t)),this},fadeOut:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:0}].concat(t)),this},fadeTo:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:t.splice(0,1)[0]}].concat(t)),this},dragAndDrop:function(t){if(!1===(t=t===i?{}:t)&&!0===this.draggable)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var e=this,s={x:0,y:0},r={x:0,y:0},n={x:0,y:0};this._.drag_start=function(i){!1===t.bubble&&i.stopPropagation(),this.dragging=!0,s.x=i.x-this.x,s.y=i.y-this.y,r.x=this.x,r.y=this.y,n=e.core.tools.transformPointerPosition(e,e.abs_x,e.abs_y,e.rotation),!0===t.changeZindex&&(this.zIndex="front"),"function"==typeof t.start&&t.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(i){e.dragging&&(!1===t.bubble&&i.stopPropagation(),e.dragging=!1,"function"==typeof t.end&&t.end.call(e),e.core.timeline.running||e.core.draw.redraw())},this._.drag_move=function(i){if(e.dragging){!1===t.bubble&&i.stopPropagation();var s=e.core.tools.transformPointerPosition(e,e.abs_x,e.abs_y,e.rotation);e.x=r.x+s.x-n.x,e.y=r.y+s.y-n.y,"function"==typeof t.move&&t.move.call(e),e.core.timeline.running||e.core.draw.redraw()}},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},getOrigin:function(){var t=this.origin,e=this.shapeType;return{x:"center"===t.x?"rectangular"===e?this.width/2:0:"right"===t.x?"rectangular"===e?this.width:this.radius:"left"===t.x?"rectangular"===e?0:-this.radius:isNaN(parseFloat(t.x))?0:parseFloat(t.x),y:"center"===t.y?"rectangular"===e?this.height/2:0:"bottom"===t.y?"rectangular"===e?this.height:this.radius:"top"===t.y?"rectangular"===e?0:-this.radius:isNaN(parseFloat(t.y))?0:parseFloat(t.y)}},addChild:function(t,e){return this.addChildAt(t,this.children.length,e)},addChildAt:function(t,e,s){var r;if(t.parent===i){if(e>=this.children.length?r=this.children.push(t)-1:e<0?(this.children.unshift(t),r=0):(this.children.splice(e,0,t),r=e),t.parent=this,t.x+=0,t.y+=0,this.core.draw.objects.push(t),this.drawn&&this.core.draw.redraw(),s)return r}else if(s)return!1;return this},removeChild:function(t,e){var i=this.children.indexOf(t);return~i&&this.removeChildAt(i,e),this},removeChildAt:function(t,e){return this.children[t]!==i&&this.children[t].remove(e),this},clone:function(t){(t=t||{}).drawn=!1;var e,r,n,a,o,h,c,l,d,u=this.parent,f=this.core.display[this.type](t),g={},p=["core","events","children","parent","img","image","fill","strokeColor","added"],y=["abs_x","start_x","end_x"],b=["abs_y","start_y","end_y"];if((e=function(t,s){for(r in t)if(!~p.indexOf(r)&&(d=Object.getPropertyDescriptor(t,r))&&d.get===i){if("object"==typeof t[r]){s[r]=t[r].constructor===Array?[]:{},e(t[r],s[r]);continue}var n=t[r];u&&(y.indexOf(r)>-1?n-=u.abs_x:b.indexOf(r)>-1&&(n-=u.abs_y)),s[r]=n}})(this,g),g.fill=this._.fill,n=this.core.style.getStroke(this.stroke),g.strokeColor=n.color,this.image&&(g.image=this.image),(f=s.extend(f,g,t)).id=++this.core.lastObjectID,"function"==typeof f.init&&f.init(),(o=this.children).length>0)for(a=0;a<o.length;a++)h=o[a].clone(),f.children.push(h),h.parent=f,t.x&&(c=Math.abs(o[a].abs_x-this.x),h.x=c),t.y&&(l=Math.abs(o[a].abs_y-this.y),h.y=l);return f},isPointerInside:function(t){return this.core.tools.isPointerInside(this,t)}}};s.registerModule("displayObject",r),s.registerModule("display",{wrapper:!0,register:function(t,e,n,a){var o=this.core,h=function(i,r){return s.extend({core:r,type:t,shapeType:"rectangular",draw:function(){return n.call(this,o.canvas,o),this}},e,i)};return this[t]=function(t){var e=s.extend(Object.create(r()),new h(t,o));return a!==i&&"function"==typeof e[a]&&e[a](),e},this}}),s.registerDisplayObject=function(t,e,n){s.registerModule("display."+t,{setCore:function(a){return function(o){var h=s.extend(Object.create(r()),new e(o,a));return h.type=t,h.id=++a.lastObjectID,a.animation.queues.create(h,"default"),n!==i&&h[n](),h}}})},s.registerDisplayObject("rectangle",function(t,e){function r(t,e){return Math.max(Math.min(t,e),0)}function n(t,e,s){return t!==i?r(t,s):e!==i?r(e,s):0}function a(t,e){return e>0?{topLeft:0===t.topLeft?0:t.topLeft+e,topRight:0===t.topRight?0:t.topRight+e,bottomLeft:0===t.bottomLeft?0:t.bottomLeft+e,bottomRight:0===t.bottomRight?0:t.bottomRight+e}:e<0?{topLeft:Math.max(t.topLeft+e,0),topRight:Math.max(t.topRight+e,0),bottomLeft:Math.max(t.bottomLeft+e,0),bottomRight:Math.max(t.bottomRight+e,0)}:t}function o(t,e,i,s,r,n,a){var o=e+s,h=i+r;a?(t.moveTo(o-n.topRight,i),t.arcTo(e,i,e,i+n.topLeft,n.topLeft),t.arcTo(e,h,e+n.bottomLeft,h,n.bottomLeft),t.arcTo(o,h,o,h-n.bottomRight,n.bottomRight),t.arcTo(o,i,o-n.topRight,i,n.topRight)):(t.moveTo(e+n.topLeft,i),t.arcTo(o,i,o,i+n.topRight,n.topRight),t.arcTo(o,h,o-n.bottomRight,h,n.bottomRight),t.arcTo(e,h,e,h-n.bottomLeft,n.bottomLeft),t.arcTo(e,i,e+n.topLeft,i,n.topLeft))}return s.extend({core:e,shapeType:"rectangular",clipChildren:!1,_:s.extend({},e.displayObject._,{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderRadius:0}),set borderTopLeftRadius(t){this._.borderTopLeftRadius=parseFloat(t,10)},get borderTopLeftRadius(){return this._.borderTopLeftRadius},set borderTopRightRadius(t){this._.borderTopRightRadius=parseFloat(t,10)},get borderTopRightRadius(){return this._.borderTopRightRadius},set borderBottomRightRadius(t){this._.borderBottomRightRadius=parseFloat(t,10)},get borderBottomRightRadius(){return this._.borderBottomRightRadius},set borderBottomLeftRadius(t){this._.borderBottomLeftRadius=parseFloat(t,10)},get borderBottomLeftRadius(){return this._.borderBottomLeftRadius},set borderRadius(t){var e=parseFloat(t,10);this._.borderRadius=e,this._.borderTopLeftRadius=e,this._.borderTopRightRadius=e,this._.borderBottomRightRadius=e,this._.borderBottomLeftRadius=e},get borderRadius(){var t=this._.borderTopLeftRadius,e=this._.borderTopRightRadius,i=this._.borderBottomRightRadius;return t===e&&e===i&&i===this._.borderBottomLeftRadius&&(this._.borderRadius=t),this._.borderRadius},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y,r=function(t,e,i,s,r,a){return{topLeft:n(e,t,a),topRight:n(i,t,a),bottomLeft:n(s,t,a),bottomRight:n(r,t,a)}}(this.borderRadius,this.borderTopLeftRadius,this.borderTopRightRadius,this.borderBottomLeftRadius,this.borderBottomRightRadius,Math.min(this.width,this.height)/2);if(function(t){return t.topLeft>0||t.topRight>0||t.bottomLeft>0||t.bottomRight>0}(r)){t.beginPath(),o(t,i,s,this.width,this.height,r),t.closePath(),""!==this.fill&&(t.fillStyle=this.fill,t.fill());var h=!1;this.strokeWidth>0&&("center"===this.strokePosition?(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()):(t.beginPath(),"inside"===this.strokePosition?(o(t,i,s,this.width,this.height,r),o(t,i+this.strokeWidth,s+this.strokeWidth,this.width-2*this.strokeWidth,this.height-2*this.strokeWidth,a(r,-this.strokeWidth),!0)):"outside"===this.strokePosition&&(o(t,i-this.strokeWidth,s-this.strokeWidth,this.width+2*this.strokeWidth,this.height+2*this.strokeWidth,a(r,this.strokeWidth),!0),o(t,i,s,this.width,this.height,r)),t.closePath(),t.fillStyle=this.strokeColor,t.fill(),h=!0)),this.clipChildren&&(h&&(t.beginPath(),o(t,i,s,this.width,this.height,r),t.closePath()),t.clip())}else t.beginPath(),t.rect(i,s,this.width,this.height),t.closePath(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,"outside"===this.strokePosition?t.strokeRect(i-this.strokeWidth/2,s-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):"center"===this.strokePosition?t.strokeRect(i,s,this.width,this.height):"inside"===this.strokePosition&&t.strokeRect(i+this.strokeWidth/2,s+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),this.clipChildren&&t.clip();return this}},t)}),s.registerDisplayObject("image",function(t,e){return s.extend({core:e,_:s.extend({},e.displayObject._,{hasBeenDrawn:!1}),shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,clipChildren:!1,init:function(){var t=this;if(this.image!==i){var e=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=e?this.image:new Image;var s=function(){t.loaded=!0,0!==t.width?0===t.height&&(t.height=t.width/(this.width/this.height)):t.width=this.width,0!==t.height?0===t.width&&(t.width=t.height/(this.height/this.width)):t.height=this.height,t.tile_width=0===t.tile_width?t.width:t.tile_width,t.tile_height=0===t.tile_height?t.height:t.tile_height,t._.hasBeenDrawn&&t.core.redraw()};e&&this.img.complete?s.call(this.img):(this.img.addEventListener("load",s),e||(this.img.src=this.image))}},draw:function(){var t,e,s=this.core.canvas,r=this,n=this.getOrigin(),a=this.abs_x-n.x,o=this.abs_y-n.y;if(this.loaded&&this.core.draw.objects[this.zIndex]!==i&&this.img.width>0&&this.img.height>0){if(t=0===this.width?this.img.width:this.width,e=0===this.height?this.img.height:this.height,this.tile){var h,c,l=Math.ceil(t/this.tile_width),d=Math.ceil(e/this.tile_height);for(s.save(),s.beginPath(),s.moveTo(a,o),s.lineTo(a+t,o),s.lineTo(a+t,o+e),s.lineTo(a,o+e),s.lineTo(a,o),s.clip(),c=0;c<d;c++)for(h=0;h<l;h++)s.drawImage(this.img,a+h*(this.tile_width+this.tile_spacing_x),o+c*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);s.closePath(),s.restore()}else s.drawImage(this.img,a,o,t,e);this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.strokeRect(a,o,t,e)),!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){r.draw()},100);return this.clipChildren&&(s.beginPath(),s.rect(a,o,t,e),s.closePath(),s.clip()),this._.hasBeenDrawn=!0,this}},t)},"init");var n=[];s.registerDisplayObject("text",function(t,i){var r=function(t,e,i,s,r){var n=r.style.getFont(t.font);n[e]=i,t._.font=r.style.getFont(n,"string"),"lineHeight"===s?(t._.lineHeight=isNaN(parseInt(i,10))?1:parseInt(i,10),t._.lineHeightUnit="string"==typeof i&&i.indexOf("px")>-1?"px":"relative"):t._[s]=i};return s.extend({core:i,shapeType:"rectangular",align:"start",baseline:"top",_:s.extend({},i.displayObject._,{hasBeenDrawn:!1,font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0,lines:[]}),set font(t){"string"!=typeof t&&(t=this.core.style.getFont(t,"string"));var e=this.core.style.getFont(t);t=this.core.style.getFont(e,"string"),this._.style=e.style,this._.variant=e.variant,this._.weight=e.weight,this._.size=e.size,this._.lineHeight=e.lineHeight,this._.lineHeightUnit=e.lineHeightUnit,this._.family=e.family,this._.font=t,this.initWebFont(),this.setDimensions()},set style(t){r(this,"style",t,"style",this.core),this.initWebFont(),this.setDimensions()},set variant(t){r(this,"variant",t,"variant",this.core),this.initWebFont(),this.setDimensions()},set weight(t){r(this,"weight",t,"weight",this.core),this.initWebFont(),this.setDimensions()},set size(t){r(this,"size",t,"size",this.core),this.setDimensions()},set lineHeight(t){r(this,"lineHeight",t,"lineHeight",this.core),this.setDimensions()},set family(t){r(this,"family",t,"family",this.core),this.initWebFont(),this.setDimensions()},set text(t){this._.text=t,this.setDimensions()},set width(t){},set height(t){},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight+("px"===this._.lineHeightUnit?"px":0)},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.initWebFont(),this.setDimensions()},setDimensions:function(){if(this._.initialized){var t,e,i,s,r,n,a,o,h;for((t=this.core.canvas).fillStyle=this.fill,t.font=this.font,i=(e=this.text.toString().split("\n")).length,r=0,n=0,h=[],a=0;a<i;a++)r=(o=t.measureText(e[a])).width>r?o.width:r,n+=s="px"===this._.lineHeightUnit?this._.lineHeight:this.size*this._.lineHeight,h.push({text:e[a],width:o.width,height:s});this._.width=r,this._.height=n,this._.lines=h}},initWebFont:function(){var t=this.style+" "+this.variant+" "+this.weight+" 0px "+this.family;if(!(n.indexOf(t)>-1)){n.push(t);var i,s=this,r=this.core;(i=e.createElement("span")).style.font=t,e.body.appendChild(i),setTimeout(function(){e.body.removeChild(i),s._.hasBeenDrawn&&r.redraw()},1e3)}},getAlignOffset:function(){return{start:"rtl"===this.core.canvasElement.dir?-this.width:0,end:"rtl"===this.core.canvasElement.dir?0:-this.width,left:0,center:-this.width/2,right:-this.width}[this.align]||0},getBaselineOffset:function(){return{top:.82*this.size,hanging:.65*this.size,middle:.31*this.size,alphabetic:0,ideographic:-.05*this.size,bottom:-.22*this.size}[this.baseline]||0},draw:function(){var t,e,i,s,r,n,a,o,h,c;if(t=this.core.canvas,e=this._.lines,i=this.getAlignOffset(),s=this.getBaselineOffset(),r="top"!==this.baseline?this.size*(("px"===this._.lineHeightUnit?this._.lineHeight/this.size:this._.lineHeight)-1)/2:0,n=this.getOrigin(),a=this.abs_x-n.x-i,o=this.abs_y-n.y+s-r,t.beginPath(),t.font=this.font,t.textAlign=this.align,t.textBaseline="alphabetic",this.strokeWidth>0)for(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,h=0,c=e.length;h<c;h++)t.strokeText(e[h].text,a,o+h*e[h].height+(e[h].height-this.size)/2);if(""!==this.fill)for(t.fillStyle=this.fill,h=0,c=e.length;h<c;h++)t.fillText(e[h].text,a,o+h*e[h].height+(e[h].height-this.size)/2);return t.closePath(),this._.hasBeenDrawn=!0,this}},t)},"init"),s.registerDisplayObject("arc",function(t,e){return s.extend({core:e,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",pieSection:!1,clipChildren:!1,draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;return t.beginPath(),this.radius>0&&this.start!==this.end&&(this.pieSection&&t.moveTo(i,s),t.arc(i,s,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,"anticlockwise"===this.direction),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke())),t.closePath(),this.clipChildren&&t.clip(),this}},t)}),s.registerDisplayObject("ellipse",function(t,e){return s.extend({core:e,shapeType:"radial",clipChildren:!1,_:s.extend({},e.displayObject._,{radius_x:0,radius_y:0}),set radius(t){this._.radius_x=t,this._.radius_y=t},set radius_x(t){this._.radius_x=t},set radius_y(t){this._.radius_y=t},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},getOrigin:function(){return{x:"right"===this.origin.x?this.radius_x:"left"===this.origin.x?-this.radius_x:isNaN(parseFloat(this.origin.x))?0:parseFloat(this.origin.x),y:"bottom"===this.origin.y?this.radius_y:"top"===this.origin.y?-this.radius_y:isNaN(parseFloat(this.origin.y))?0:parseFloat(this.origin.y)}},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;if(t.beginPath(),this.radius_x===this.radius_y)t.arc(i,s,this.radius_x,0,2*Math.PI,!1);else{var r={x:2*this.radius_x*.276142374915397,y:2*this.radius_y*.276142374915397};t.moveTo(i-this.radius_x,s),t.bezierCurveTo(i-this.radius_x,s-r.y,i-r.x,s-this.radius_y,i,s-this.radius_y),t.bezierCurveTo(i+r.x,s-this.radius_y,i+this.radius_x,s-r.y,i+this.radius_x,s),t.bezierCurveTo(i+this.radius_x,s+r.y,i+r.x,s+this.radius_y,i,s+this.radius_y),t.bezierCurveTo(i-r.x,s+this.radius_y,i-this.radius_x,s+r.y,i-this.radius_x,s)}return""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()),t.closePath(),this.clipChildren&&t.clip(),this}},t)}),s.registerDisplayObject("polygon",function(t,e){return s.extend({core:e,shapeType:"radial",sides:3,clipChildren:!1,_:s.extend({},e.displayObject._,{radius:0,side:0}),set radius(t){this._.radius=t,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(t){this._.side=t,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var t,e,i,s=this.core.canvas,r=this.getOrigin(),n=this.abs_x-r.x,a=this.abs_y-r.y,o={x:0,y:0},h=this.sides,c=this.radius;for(s.beginPath(),i=0;i<=h;i++)t=n+c*Math.cos(2*i*Math.PI/h),e=a+c*Math.sin(2*i*Math.PI/h),0===i?(s.moveTo(t,e),o={x:t,y:e}):i==h?s.lineTo(o.x,o.y):s.lineTo(t,e);return s.closePath(),""!==this.fill&&(s.fillStyle=this.fill,s.fill()),this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.stroke()),this.clipChildren&&s.clip(),this}},t)}),s.registerDisplayObject("line",function(t,e){return s.extend({core:e,shapeType:"radial",_:s.extend({},e.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:0,y:0,abs_x:0,abs_y:0}),children:[],set start(t){this._.start_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.start_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},set end(t){this._.end_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.end_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},get start(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.start_x-t.x},get y(){return e._.start_y-t.y},set x(t){e._.start_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.start_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},get end(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.end_x-t.x},get y(){return e._.end_y-t.y},set x(t){e._.end_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.end_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},set x(t){var e,i,s,r,n;for(e=this._.end_x-this._.start_x,i=this.parent&&!this.parent.isCore?this.parent._.abs_x:0,this._.x=t,this._.abs_x=t+i,this._.start_x=t-e/2+i,this._.end_x=t+e/2+i,r=(s=this.children).length,n=0;n<r;n++)s[n]._.abs_x=this.abs_x+s[n].x,s[n].x+=0},set y(t){var e,i,s,r,n;for(e=this._.end_y-this._.start_y,i=this.parent&&!this.parent.isCore?this.parent._.abs_y:0,this._.y=t,this._.abs_y=t+i,this._.start_y=t-e/2+i,this._.end_y=t+e/2+i,r=(s=this.children).length,n=0;n<r;n++)s[n]._.abs_y=this.abs_y-s[n].y,s[n].y+=0},get x(){return this._.x},get y(){return this._.y},set length(t){var e,i,s,r;e=Math.abs(this._.end_x-this._.start_x),i=Math.abs(this._.end_y-this._.start_y),s=Math.sqrt(e*e+i*i),r=Math.asin(e/s),e=Math.sin(r)*t,i=Math.cos(r)*t,this._.end_x=this._.start_x+e,this._.end_y=this._.start_y+i,this.x+=0,this.y+=0,this.setPosition()},get length(){var t,e;return t=Math.abs(this._.end_x-this._.start_x),e=Math.abs(this._.end_y-this._.start_y),Math.sqrt(t*t+e*e)},set radius(t){this.length=2*t},get radius(){return this.length/2},setPosition:function(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y),this.x=this._.start_x-t.x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y-t.y+(this._.end_y-this._.start_y)/2},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.core.draw.translation;return t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.beginPath(),t.moveTo(this._.start_x-i.x-e.x,this._.start_y-i.y-e.y),t.lineTo(this._.end_x-i.x-e.x,this._.end_y-i.y-e.y),t.stroke(),t.closePath(),this}},t)},"init"),s.registerDisplayObject("sprite",function(t,e){return s.extend({core:e,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,numFrames:0,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,clipChildren:!1,_:s.extend({},e.displayObject._,{autostart:!1,hasBeenDrawn:!1}),set autostart(t){this.active=t,this._.autostart=t},get autostart(){return this._.autostart},init:function(){if(this.image!==i){var t=this,e=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=e?this.image:new Image;var s=function(){var e,i,s;if(t.full_width=this.width,t.full_height=this.height,t.generate)for(e=t.direction,t.numFrames>0?i=t.numFrames:t.numFrames=i=("y"===e?t.full_height:t.full_width)/("y"===e?t.height:t.width),t.frames=[],s=0;s<i;s++)t.frames.push({x:t.offset_x+s*("x"===e?t.width:0),y:t.offset_y+s*("y"===e?t.height:0),d:t.duration});t.loaded=!0,t._.hasBeenDrawn&&t.core.redraw()};e&&this.img.complete?s.call(this.img):(this.img.addEventListener("load",s),e||(this.img.src=this.image))}},draw:function(){var t,e=this,s=this.core.canvas,r=this.getOrigin(),n=this.abs_x-r.x,a=this.abs_y-r.y,o=0,h=0;if(this.loaded){if(this.frames.length>0){if(this.frame>this.frames.length)return this.clipChildren&&(s.beginPath(),s.rect(n,a,0,0),s.closePath(),s.clip()),this;s.drawImage(this.img,(t=this.frames[this.frame-1]).x,t.y,o=t.w!==i?t.w:this.width,h=t.h!==i?t.h:this.height,n,a,o,h),this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.strokeRect(n,a,o,h)),!1===this.running&&this.active&&(setTimeout(function(){e.frame=e.loop?e.frame===e.frames.length?1:e.frame+1:e.frame===e.frames.length?e.frame:e.frame+1,e.running=!1,e.core.timeline.running||e.core.draw.redraw()},t.d),this.running=!0)}!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){e.draw()},100);return this.clipChildren&&(s.beginPath(),s.rect(n,a,o,h),s.closePath(),s.clip()),this._.hasBeenDrawn=!0,this},start:function(){return this.startAnimation(),this},startAnimation:function(){return this.active=!0,this.core.redraw(),this},stopAnimation:function(){return this.active=!1,this}},t)},"init")}(window,document),function(){"use strict";var t=Object.prototype,e=t.__defineGetter__,i=t.__defineSetter__,s=t.__lookupGetter__,r=t.__lookupSetter__,n=t.hasOwnProperty;e&&i&&s&&r&&(Object.defineProperty||(Object.defineProperty=function(t,a,o){if(arguments.length<3)throw new TypeError("Arguments not optional");if(a+="",n.call(o,"value")&&(s.call(t,a)||r.call(t,a)||(t[a]=o.value),n.call(o,"get")||n.call(o,"set")))throw new TypeError("Cannot specify an accessor and a value");return o.get&&e.call(t,a,o.get),o.set&&i.call(t,a,o.set),t}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(t,e){if(arguments.length<2)throw new TypeError("Arguments not optional.");var i={configurable:!0,enumerable:!0,writable:!0},a=s.call(t,e+=""),o=r.call(t,e);return n.call(t,e)?a||o?(delete i.writable,i.get=i.set=void 0,a&&(i.get=a),o&&(i.set=o),i):(i.value=t[e],i):i}),Object.defineProperties||(Object.defineProperties=function(t,e){for(var i in e)n.call(e,i)&&Object.defineProperty(t,i,e[i])}))}();